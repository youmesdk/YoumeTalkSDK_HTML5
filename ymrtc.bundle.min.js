!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.YMRTC=t()}(this,function(){"use strict";var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var t=!0,r=!0;function n(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}var i,a={extractVersion:n,wrapPeerConnectionEvent:function(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var a=function(e){n(r(e))};return this._eventMap=this._eventMap||{},this._eventMap[n]=a,i.apply(this,[e,a])};var a=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return a.apply(this,arguments);var n=this._eventMap[r];return delete this._eventMap[r],a.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)}})}},disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(t=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(t)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){r&&console.warn(e+" is deprecated, please use "+t+" instead.")},detectBrowser:function(e){var t=e&&e.navigator,r={};if(r.browser=null,r.version=null,void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=n(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)r.browser="chrome",r.version=n(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=n(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.mediaDevices||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=n(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return r}},o=a.log,s=a.log,c={shimGetUserMedia:function(e){var t=a.detectBrowser(e),r=e&&e.navigator,n=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n="object"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var a={};"number"==typeof n.ideal?(a[i("min",r)]=n.ideal,t.optional.push(a),(a={})[i("max",r)]=n.ideal,t.optional.push(a)):(a[i("",r)]=n.ideal,t.optional.push(a))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",r)]=n.exact):["min","max"].forEach(function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,r)]=n[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var a=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"==typeof e.video){var s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});var c,u=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||u)&&(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?c=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(c=["front"]),c))return r.mediaDevices.enumerateDevices().then(function(t){var r=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return c.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!r&&t.length&&-1!==c.indexOf("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=s.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=n(e.video),o("chrome: "+JSON.stringify(e)),i(e)});e.video=n(e.video)}return o("chrome: "+JSON.stringify(e)),i(e)},s=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};r.getUserMedia=function(e,t,n){i(e,function(e){r.webkitGetUserMedia(e,t,function(e){n&&n(s(e))})})};var c=function(e){return new Promise(function(t,n){r.getUserMedia(e,t,n)})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:c,enumerateDevices:function(){return new Promise(function(t){var r={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:r[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),r.mediaDevices.getUserMedia){var u=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return i(e,function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(s(e))})})}}else r.mediaDevices.getUserMedia=function(e){return c(e)};void 0===r.mediaDevices.addEventListener&&(r.mediaDevices.addEventListener=function(){o("Dummy mediaDevices.addEventListener called.")}),void 0===r.mediaDevices.removeEventListener&&(r.mediaDevices.removeEventListener=function(){o("Dummy mediaDevices.removeEventListener called.")})},shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)"RTCRtpTransceiver"in e||a.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||(e.transceiver={receiver:e.receiver}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return r._ontrackpoly||(r._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.track.id}):{track:n.track};var a=new Event("track");a.track=n.track,a.receiver=i,a.transceiver={receiver:i},a.streams=[t.stream],r.dispatchEvent(a)}),t.stream.getTracks().forEach(function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.id}):{track:n};var a=new Event("track");a.track=n,a.receiver=i,a.transceiver={receiver:i},a.streams=[t.stream],r.dispatchEvent(a)})},r.addEventListener("addstream",r._ontrackpoly)),t.apply(r,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;r._senders=r._senders||[],i.apply(r,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],a.apply(t,[e]),e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});r&&t._senders.splice(t._senders.indexOf(r),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var o=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=o.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var r=this;this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)})):this.src=""}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var n=t.getSenders();r.apply(this,arguments);var i=t.getSenders().filter(function(e){return-1===n.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]}),i.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){var t=a.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{},t.getTracks().forEach(function(e){if(r.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!r._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());r._streams[t.id]=i,r._reverseStreams[i.id]=t,t=i}n.apply(r,[t])};var i=e.RTCPeerConnection.prototype.removeStream;function o(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},i.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(n.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{};var a=n._streams[r.id];if(a)a.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var o=new e.MediaStream([t]);n._streams[r.id]=o,n._reverseStreams[o.id]=r,n.addStream(o)}return n.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(e,[function(r){var n=o(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(e,arguments).then(function(t){return o(e,t)})}});var s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e,t,r;return arguments.length&&arguments[0].type?(arguments[0]=(e=this,t=arguments[0],r=t.sdp,Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})),s.apply(this,arguments)):s.apply(this,arguments)};var c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=c.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===r))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");r._streams=r._streams||{},Object.keys(r._streams).forEach(function(n){r._streams[n].getTracks().find(function(t){return e.track===t})&&(t=r._streams[n])}),t&&(1===t.getTracks().length?r.removeStream(r._reverseStreams[t.id]):t.removeTrack(e.track),r.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(e){var t=a.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection)e.RTCPeerConnection=function(t,r){return s("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,r)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});else{var r=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(a.deprecated("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,n.push(o)):n.push(e.iceServers[i])}e.iceServers=n}return new r(e,t)},e.RTCPeerConnection.prototype=r.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return r.generateCertificate}})}var n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,r){var i=this,a=arguments;if(arguments.length>0&&"function"==typeof e)return n.apply(this,arguments);if(0===n.length&&(0===arguments.length||"function"!=typeof arguments[0]))return n.apply(this,[]);var o=function(e){var t={};return e.result().forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){return n.apply(this,[function(e){a[1](s(o(e)))},arguments[0]])}return new Promise(function(e,t){n.apply(i,[function(t){e(s(o(t)))},t])}).then(t,r)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,n=new Promise(function(n,i){r.apply(t,[e[0],n,i])});return e.length<2?n:n.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(n,i){r.apply(e,[n,i,t])})}return r.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var i=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},u=(function(e){var t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},t.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},t.matchPrefix=function(e,r){return t.splitLines(e).filter(function(e){return 0===e.indexOf(r)})},t.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},t.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),e.ufrag&&(t.push("ufrag"),t.push(e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.numChannels=3===t.length?parseInt(t[2],10):1,r},t.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},t.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r[(t=n[i].trim().split("="))[0].trim()]=t[1];return r},t.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){n.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},t.getMid=function(e){var r=t.matchPrefix(e,"a=mid:")[0];if(r)return r.substr(6)},t.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},t.getDtlsParameters=function(e,r){return{role:"auto",fingerprints:t.matchPrefix(e+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},t.getIceParameters=function(e,r){var n=t.splitLines(e);return{usernameFragment:(n=n.concat(t.splitLines(r))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},t.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},t.parseRtpParameters=function(e){for(var r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var a=n[i],o=t.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(o){var s=t.parseRtpMap(o),c=t.matchPrefix(e,"a=fmtp:"+a+" ");switch(s.parameters=c.length?t.parseFmtp(c[0]):{},s.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(t.parseRtcpFb),r.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(s.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach(function(e){r.headerExtensions.push(t.parseExtmap(e))}),r},t.writeRtpDescription=function(e,r){var n="";n+="m="+e+" ",n+=r.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=r.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",r.codecs.forEach(function(e){n+=t.writeRtpMap(e),n+=t.writeFmtp(e),n+=t.writeRtcpFb(e)});var i=0;return r.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",r.headerExtensions.forEach(function(e){n+=t.writeExtmap(e)}),n},t.parseRtpEncodingParameters=function(e){var r,n=[],i=t.parseRtpParameters(e),a=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map(function(e){return t.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,u=t.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(r=u[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:r}};n.push(t),a&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:r,mechanism:o?"red+ulpfec":"red"},n.push(t))}}),0===n.length&&c&&n.push({ssrc:c});var d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=d})),n},t.parseRtcpParameters=function(e){var r={},n=t.matchPrefix(e,"a=ssrc:").map(function(e){return t.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);var i=t.matchPrefix(e,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=0===i.length;var a=t.matchPrefix(e,"a=rtcp-mux");return r.mux=a.length>0,r},t.parseMsid=function(e){var r,n=t.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(r=n[0].substr(7).split(" "))[0],track:r[1]};var i=t.matchPrefix(e,"a=ssrc:").map(function(e){return t.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?{stream:(r=i[0].value.split(" "))[0],track:r[1]}:void 0},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,r){var n=void 0!==r?r:2;return"v=0\r\no=thisisadapterortc "+(e||t.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.writeMediaSection=function(e,r,n,i){var a=t.writeRtpDescription(e.kind,r);if(a+=t.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=t.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),a+="a=mid:"+e.mid+"\r\n",e.direction?a+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var o="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";a+="a="+o,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+"\r\n"),a},t.getDirection=function(e,r){for(var n=t.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){var r=t.splitLines(e)[0].split(" ");return{kind:r[0].substr(2),port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.exports=t}(i={exports:{}},i.exports),i.exports);function d(e,t,r,n,i){var a=u.writeRtpDescription(e.kind,t);if(a+=u.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=u.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":i||"active"),a+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var o="msid:"+(n?n.id:"-")+" "+e.rtpSender.track.id+"\r\n";a+="a="+o,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+u.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+u.localCName+"\r\n"),a}function l(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]};return e.codecs.forEach(function(i){for(var a=0;a<t.codecs.length;a++){var o=t.codecs[a];if(i.name.toLowerCase()===o.name.toLowerCase()&&i.clockRate===o.clockRate){if("rtx"===i.name.toLowerCase()&&i.parameters&&o.parameters.apt&&(s=i,c=o,u=e.codecs,d=t.codecs,l=void 0,p=void 0,l=n(s.parameters.apt,u),p=n(c.parameters.apt,d),!l||!p||l.name.toLowerCase()!==p.name.toLowerCase()))continue;(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(i.numChannels,o.numChannels),r.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter(function(e){for(var t=0;t<i.rtcpFeedback.length;t++)if(i.rtcpFeedback[t].type===e.type&&i.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}var s,c,u,d,l,p}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var i=t.headerExtensions[n];if(e.uri===i.uri){r.headerExtensions.push(i);break}}}),r}function p(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function f(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return r||e.addRemoteCandidate(t),!r}function m(e,t){var r=new Error(t);return r.name=e,r}var h=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function n(t,r,n,i){var a=new Event("track");a.track=r,a.receiver=n,a.transceiver={receiver:n},a.streams=i,e.setTimeout(function(){t._dispatchEvent("track",a)})}var i=function(r){var n,i,a,o=this,s=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){o[e]=s[e].bind(s)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw m("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=(n=r.iceServers||[],i=t,a=!1,(n=JSON.parse(JSON.stringify(n))).filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r="string"==typeof t;return r&&(t=[t]),t=t.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||a?0===e.indexOf("stun:")&&i>=14393&&-1===e.indexOf("?transport=udp"):(a=!0,!0)}),delete e.url,e.urls=r?t[0]:t,!!t.length}})),this._iceGatherers=[],r.iceCandidatePoolSize)for(var c=r.iceCandidatePoolSize;c>0;c--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=u.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};i.prototype.onicecandidate=null,i.prototype.onaddstream=null,i.prototype.ontrack=null,i.prototype.onremovestream=null,i.prototype.onsignalingstatechange=null,i.prototype.oniceconnectionstatechange=null,i.prototype.onicegatheringstatechange=null,i.prototype.onnegotiationneeded=null,i.prototype.ondatachannel=null,i.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},i.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},i.prototype.getConfiguration=function(){return this._config},i.prototype.getLocalStreams=function(){return this.localStreams},i.prototype.getRemoteStreams=function(){return this.remoteStreams},i.prototype._createTransceiver=function(e){var t=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&t)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var n=this._createIceAndDtlsTransports();r.iceTransport=n.iceTransport,r.dtlsTransport=n.dtlsTransport}return this.transceivers.push(r),r},i.prototype.addTrack=function(t,r){if(this._isClosed)throw m("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find(function(e){return e.track===t}))throw m("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(n=this.transceivers[i]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),n.track=t,n.stream=r,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},i.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach(function(t){r.addTrack(t,e)});else{var n=e.clone();e.getTracks().forEach(function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),n.getTracks().forEach(function(e){r.addTrack(e,n)})}},i.prototype.removeTrack=function(t){if(this._isClosed)throw m("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find(function(e){return e.rtpSender===t});if(!r)throw m("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},i.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});r&&t.removeTrack(r)})},i.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},i.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},i.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;i.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},i.prototype._gather=function(t,r){var n=this,i=this.transceivers[r].iceGatherer;if(!i.onlocalcandidate){var a=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,i.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),i.onlocalcandidate=function(e){if(!(n.usingBundle&&r>0)){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:r};var o=e.candidate,s=!o||0===Object.keys(o).length;if(s)"new"!==i.state&&"gathering"!==i.state||(i.state="completed");else{"new"===i.state&&(i.state="gathering"),o.component=1;var c=u.writeCandidate(o);a.candidate=Object.assign(a.candidate,u.parseCandidate(c)),a.candidate.candidate=c}var d=u.splitSections(n.localDescription.sdp);d[a.candidate.sdpMLineIndex+1]+=s?"a=end-of-candidates\r\n":"a="+a.candidate.candidate+"\r\n",n.localDescription.sdp=d.join("");var l=n.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==n.iceGatheringState&&(n.iceGatheringState="gathering",n._emitGatheringStateChange()),s||n._dispatchEvent("icecandidate",a),l&&(n._dispatchEvent("icecandidate",new Event("icecandidate")),n.iceGatheringState="complete",n._emitGatheringStateChange())}},e.setTimeout(function(){a.forEach(function(e){i.onlocalcandidate(e)})},0)}},i.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},i.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},i.prototype._transceive=function(e,r,n){var i=l(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:u.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),n&&e.rtpReceiver&&i.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length&&(i.encodings=e.recvEncodingParameters),i.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(i.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},i.prototype.setLocalDescription=function(e){var t,r,n=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(m("TypeError",'Unsupported type "'+e.type+'"'));if(!p("setLocalDescription",e.type,n.signalingState)||n._isClosed)return Promise.reject(m("InvalidStateError","Can not set local "+e.type+" in state "+n.signalingState));if("offer"===e.type)t=u.splitSections(e.sdp),r=t.shift(),t.forEach(function(e,t){var r=u.parseRtpParameters(e);n.transceivers[t].localCapabilities=r}),n.transceivers.forEach(function(e,t){n._gather(e.mid,t)});else if("answer"===e.type){t=u.splitSections(n.remoteDescription.sdp),r=t.shift();var i=u.matchPrefix(r,"a=ice-lite").length>0;t.forEach(function(e,t){var a=n.transceivers[t],o=a.iceGatherer,s=a.iceTransport,c=a.dtlsTransport,d=a.localCapabilities,p=a.remoteCapabilities;if(!(u.isRejected(e)&&0===u.matchPrefix(e,"a=bundle-only").length)&&!a.isDatachannel){var f=u.getIceParameters(e,r),m=u.getDtlsParameters(e,r);i&&(m.role="server"),n.usingBundle&&0!==t||(n._gather(a.mid,t),"new"===s.state&&s.start(o,f,i?"controlling":"controlled"),"new"===c.state&&c.start(m));var h=l(d,p);n._transceive(a,h.codecs.length>0,!1)}})}return n.localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?n._updateSignalingState("have-local-offer"):n._updateSignalingState("stable"),Promise.resolve()},i.prototype.setRemoteDescription=function(i){var a=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(m("TypeError",'Unsupported type "'+i.type+'"'));if(!p("setRemoteDescription",i.type,a.signalingState)||a._isClosed)return Promise.reject(m("InvalidStateError","Can not set remote "+i.type+" in state "+a.signalingState));var o={};a.remoteStreams.forEach(function(e){o[e.id]=e});var s=[],c=u.splitSections(i.sdp),d=c.shift(),l=u.matchPrefix(d,"a=ice-lite").length>0,h=u.matchPrefix(d,"a=group:BUNDLE ").length>0;a.usingBundle=h;var v=u.matchPrefix(d,"a=ice-options:")[0];return a.canTrickleIceCandidates=!!v&&v.substr(14).split(" ").indexOf("trickle")>=0,c.forEach(function(n,c){var p=u.splitLines(n),m=u.getKind(n),v=u.isRejected(n)&&0===u.matchPrefix(n,"a=bundle-only").length,g=p[0].substr(2).split(" ")[2],y=u.getDirection(n,d),_=u.parseMsid(n),C=u.getMid(n)||u.generateIdentifier();if("application"!==m||"DTLS/SCTP"!==g){var S,k,T,b,R,P,w,E,M,O,x,I=u.parseRtpParameters(n);v||(O=u.getIceParameters(n,d),(x=u.getDtlsParameters(n,d)).role="client"),w=u.parseRtpEncodingParameters(n);var L=u.parseRtcpParameters(n),j=u.matchPrefix(n,"a=end-of-candidates",d).length>0,D=u.matchPrefix(n,"a=candidate:").map(function(e){return u.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===i.type||"answer"===i.type)&&!v&&h&&c>0&&a.transceivers[c]&&(a._disposeIceAndDtlsTransports(c),a.transceivers[c].iceGatherer=a.transceivers[0].iceGatherer,a.transceivers[c].iceTransport=a.transceivers[0].iceTransport,a.transceivers[c].dtlsTransport=a.transceivers[0].dtlsTransport,a.transceivers[c].rtpSender&&a.transceivers[c].rtpSender.setTransport(a.transceivers[0].dtlsTransport),a.transceivers[c].rtpReceiver&&a.transceivers[c].rtpReceiver.setTransport(a.transceivers[0].dtlsTransport)),"offer"!==i.type||v)"answer"!==i.type||v||(k=(S=a.transceivers[c]).iceGatherer,T=S.iceTransport,b=S.dtlsTransport,R=S.rtpReceiver,P=S.sendEncodingParameters,E=S.localCapabilities,a.transceivers[c].recvEncodingParameters=w,a.transceivers[c].remoteCapabilities=I,a.transceivers[c].rtcpParameters=L,D.length&&"new"===T.state&&(!l&&!j||h&&0!==c?D.forEach(function(e){f(S.iceTransport,e)}):T.setRemoteCandidates(D)),h&&0!==c||("new"===T.state&&T.start(k,O,"controlling"),"new"===b.state&&b.start(x)),a._transceive(S,"sendrecv"===y||"recvonly"===y,"sendrecv"===y||"sendonly"===y),!R||"sendrecv"!==y&&"sendonly"!==y?delete S.rtpReceiver:(M=R.track,_?(o[_.stream]||(o[_.stream]=new e.MediaStream),r(M,o[_.stream]),s.push([M,R,o[_.stream]])):(o.default||(o.default=new e.MediaStream),r(M,o.default),s.push([M,R,o.default]))));else{(S=a.transceivers[c]||a._createTransceiver(m)).mid=C,S.iceGatherer||(S.iceGatherer=a._createIceGatherer(c,h)),D.length&&"new"===S.iceTransport.state&&(!j||h&&0!==c?D.forEach(function(e){f(S.iceTransport,e)}):S.iceTransport.setRemoteCandidates(D)),E=e.RTCRtpReceiver.getCapabilities(m),t<15019&&(E.codecs=E.codecs.filter(function(e){return"rtx"!==e.name})),P=S.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var A,U=!1;if("sendrecv"===y||"sendonly"===y){if(U=!S.rtpReceiver,R=S.rtpReceiver||new e.RTCRtpReceiver(S.dtlsTransport,m),U)M=R.track,_&&"-"===_.stream||(_?(o[_.stream]||(o[_.stream]=new e.MediaStream,Object.defineProperty(o[_.stream],"id",{get:function(){return _.stream}})),Object.defineProperty(M,"id",{get:function(){return _.track}}),A=o[_.stream]):(o.default||(o.default=new e.MediaStream),A=o.default)),A&&(r(M,A),S.associatedRemoteMediaStreams.push(A)),s.push([M,R,A])}else S.rtpReceiver&&S.rtpReceiver.track&&(S.associatedRemoteMediaStreams.forEach(function(t){var r,n,i=t.getTracks().find(function(e){return e.id===S.rtpReceiver.track.id});i&&(r=i,(n=t).removeTrack(r),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:r})))}),S.associatedRemoteMediaStreams=[]);S.localCapabilities=E,S.remoteCapabilities=I,S.rtpReceiver=R,S.rtcpParameters=L,S.sendEncodingParameters=P,S.recvEncodingParameters=w,a._transceive(a.transceivers[c],!1,U)}}else a.transceivers[c]={mid:C,isDatachannel:!0}}),void 0===a._dtlsRole&&(a._dtlsRole="offer"===i.type?"active":"passive"),a.remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?a._updateSignalingState("have-remote-offer"):a._updateSignalingState("stable"),Object.keys(o).forEach(function(t){var r=o[t];if(r.getTracks().length){if(-1===a.remoteStreams.indexOf(r)){a.remoteStreams.push(r);var i=new Event("addstream");i.stream=r,e.setTimeout(function(){a._dispatchEvent("addstream",i)})}s.forEach(function(e){var t=e[0],i=e[1];r.id===e[2].id&&n(a,t,i,[r])})}}),s.forEach(function(e){e[2]||n(a,e[0],e[1],[])}),e.setTimeout(function(){a&&a.transceivers&&a.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},i.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},i.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},i.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},i.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0||t.checking>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":(t.connected>0||t.completed>0)&&(e="connected"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},i.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(m("InvalidStateError","Can not call createOffer after close"));var n=r.transceivers.filter(function(e){return"audio"===e.kind}).length,i=r.transceivers.filter(function(e){return"video"===e.kind}).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(n=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(i=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(r.transceivers.forEach(function(e){"audio"===e.kind?--n<0&&(e.wantReceive=!1):"video"===e.kind&&--i<0&&(e.wantReceive=!1)});n>0||i>0;)n>0&&(r._createTransceiver("audio"),n--),i>0&&(r._createTransceiver("video"),i--);var o=u.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach(function(n,i){var a=n.track,o=n.kind,s=n.mid||u.generateIdentifier();n.mid=s,n.iceGatherer||(n.iceGatherer=r._createIceGatherer(i,r.usingBundle));var c=e.RTCRtpSender.getCapabilities(o);t<15019&&(c.codecs=c.codecs.filter(function(e){return"rtx"!==e.name})),c.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")});var d=n.sendEncodingParameters||[{ssrc:1001*(2*i+1)}];a&&t>=15019&&"video"===o&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,o)),n.localCapabilities=c,n.sendEncodingParameters=d}),"max-compat"!==r._config.bundlePolicy&&(o+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n",r.transceivers.forEach(function(e,t){o+=d(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),o+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,o+="a="+u.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(o+="a=end-of-candidates\r\n"))});var s=new e.RTCSessionDescription({type:"offer",sdp:o});return Promise.resolve(s)},i.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(m("InvalidStateError","Can not call createAnswer after close"));var n=u.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(n+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var i=u.splitSections(r.remoteDescription.sdp).length-1;r.transceivers.forEach(function(e,a){if(!(a+1>i))if(e.isDatachannel)n+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+e.mid+"\r\n";else{var o;if(e.stream)"audio"===e.kind?o=e.stream.getAudioTracks()[0]:"video"===e.kind&&(o=e.stream.getVideoTracks()[0]),o&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var s=l(e.localCapabilities,e.remoteCapabilities);!s.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,n+=d(e,s,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(n+="a=rtcp-rsize\r\n")}});var a=new e.RTCSessionDescription({type:"answer",sdp:n});return Promise.resolve(a)},i.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(n,i){if(!r.remoteDescription)return i(m("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var o=0;o<r.transceivers.length;o++)if(r.transceivers[o].mid===e.sdpMid){a=o;break}var s=r.transceivers[a];if(!s)return i(m("OperationError","Can not add ICE candidate"));if(s.isDatachannel)return n();var c=Object.keys(e.candidate).length>0?u.parseCandidate(e.candidate):{};if("tcp"===c.protocol&&(0===c.port||9===c.port))return n();if(c.component&&1!==c.component)return n();if((0===a||a>0&&s.iceTransport!==r.transceivers[0].iceTransport)&&!f(s.iceTransport,c))return i(m("OperationError","Can not add ICE candidate"));var d=e.candidate.trim();0===d.indexOf("a=")&&(d=d.substr(2)),(t=u.splitSections(r.remoteDescription.sdp))[a+1]+="a="+(c.type?d:"end-of-candidates")+"\r\n",r.remoteDescription.sdp=t.join("")}else for(var l=0;l<r.transceivers.length&&(r.transceivers[l].isDatachannel||(r.transceivers[l].iceTransport.addRemoteCandidate({}),(t=u.splitSections(r.remoteDescription.sdp))[l+1]+="a=end-of-candidates\r\n",r.remoteDescription.sdp=t.join(""),!r.usingBundle));l++);n()})},i.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(r){t[r]&&e.push(t[r].getStats())})});return new Promise(function(t){var r=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){var n;e[t].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(n=e[t]).type]||n.type,r.set(t,e[t])})}),t(r)})})};var a=["createOffer","createAnswer"];return a.forEach(function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(a=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),i},v={shimGetUserMedia:function(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject({name:{PermissionDeniedError:"NotAllowedError"}[(t=e).name]||t.name,message:t.message,constraint:t.constraint,toString:function(){return this.name}});var t})}},shimPeerConnection:function(e){var t=a.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCPeerConnection=h(e,t.version)},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}},g=a.log,y={shimGetUserMedia:function(e){var t=a.detectBrowser(e),r=e&&e.navigator,n=e&&e.MediaStreamTrack,i=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},o=function(e,n,a){var o=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n=e[r]="object"==typeof e[r]?e[r]:{ideal:e[r]};if(void 0===n.min&&void 0===n.max&&void 0===n.exact||t.push(r),void 0!==n.exact&&("number"==typeof n.exact?n.min=n.max=n.exact:e[r]=n.exact,delete n.exact),void 0!==n.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof n.ideal?i[r]={min:n.ideal,max:n.ideal}:i[r]=n.ideal,e.advanced.push(i),delete n.ideal,Object.keys(n).length||delete e[r]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(g("spec: "+JSON.stringify(e)),e.audio&&(e.audio=o(e.audio)),e.video&&(e.video=o(e.video)),g("ff37: "+JSON.stringify(e))),r.mozGetUserMedia(e,n,function(e){a(i(e))})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:function(e){return new Promise(function(t,r){o(e,t,r)})},addEventListener:function(){},removeEventListener:function(){}}),r.mediaDevices.enumerateDevices=r.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var s=r.mediaDevices.enumerateDevices.bind(r.mediaDevices);r.mediaDevices.enumerateDevices=function(){return s().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var c=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return c(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(i(e))})}}if(!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var u=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},d=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),u(e.audio,"autoGainControl","mozAutoGainControl"),u(e.audio,"noiseSuppression","mozNoiseSuppression")),d(e)},n&&n.prototype.getSettings){var l=n.prototype.getSettings;n.prototype.getSettings=function(){var e=l.apply(this,arguments);return u(e,"mozAutoGainControl","autoGainControl"),u(e,"mozNoiseSuppression","noiseSuppression"),e}}if(n&&n.prototype.applyConstraints){var p=n.prototype.applyConstraints;n.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),u(e,"autoGainControl","mozAutoGainControl"),u(e,"noiseSuppression","mozNoiseSuppression")),p.apply(this,[e])}}}r.getUserMedia=function(e,n,i){if(t.version<44)return o(e,n,i);a.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(n,i)}},shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var r=new Event("track");r.track=t,r.receiver={track:t},r.transceiver={receiver:r.receiver},r.streams=[e.stream],this.dispatchEvent(r)}.bind(this))}.bind(this))}}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=a.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(r,n){if(t.version<38&&r&&r.iceServers){for(var i=[],a=0;a<r.iceServers.length;a++){var o=r.iceServers[a];if(o.hasOwnProperty("urls"))for(var s=0;s<o.urls.length;s++){var c={url:o.urls[s]};0===o.urls[s].indexOf("turn")&&(c.username=o.username,c.credential=o.credential),i.push(c)}else i.push(r.iceServers[a])}r.iceServers=i}return new e.mozRTCPeerConnection(r,n)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,a){return i.apply(this,[e||null]).then(function(e){var i,a;if(t.version<48&&(i=e,a=new Map,Object.keys(i).forEach(function(e){a.set(e,i[e]),a[e]=i[e]}),e=a),t.version<53&&!r)try{e.forEach(function(e){e.type=n[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,r){e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(r,a)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;a.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(r){r.track&&-1!==e.getTracks().indexOf(r.track)&&t.removeTrack(r)})})}},_={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(r){r.id===e&&(t=r)}),this._remoteStreams&&this._remoteStreams.forEach(function(r){r.id===e&&(t=r)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var r=this;e.getTracks().forEach(function(n){t.call(r,n,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,r){return r&&(this._localStreams?-1===this._localStreams.indexOf(r)&&this._localStreams.push(r):this._localStreams=[r]),t.call(this,e,r)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var r=this,n=e.getTracks();this.getSenders().forEach(function(e){-1!==n.indexOf(e.track)&&r.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(t._remoteStreams||(t._remoteStreams=[]),!(t._remoteStreams.indexOf(e)>=0)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}})})}}))},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};var s=function(e,t,r){var n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=s,s=function(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=s,s=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=s}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(a.deprecated("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,delete o.url,n.push(o)):n.push(e.iceServers[i])}e.iceServers=n}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var r=this;if(e){var n=r.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||r.addTransceiver("audio");var i=r.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):!0!==e.offerToReceiveVideo||i||r.addTransceiver("video")}return t.apply(r,arguments)}}},C={shimRTCIceCandidate:function(e){if(!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){"object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2));var r=new t(e),n=u.parseCandidate(e.candidate),i=Object.assign(r,n);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i},a.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var r=t.createObjectURL.bind(t),n=t.revokeObjectURL.bind(t),i=new Map,o=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++o;return i.set(t,e),a.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return r(e)},t.revokeObjectURL=function(e){n(e),i.delete(e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){return this.srcObject=i.get(e)||null,s.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=i.get(arguments[1])||null),c.apply(this,arguments)}}},shimMaxMessageSize:function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=a.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e,n,i,a;if(this._sctp=null,i=arguments[0],(a=u.splitSections(i.sdp)).shift(),a.some(function(e){var t=u.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})){var o,s=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r}(arguments[0]),c=(e=s,n=65536,"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:57===t.version?65535:65536),n),d=function(e,r){var n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);var i=u.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?n=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n}(arguments[0],s);o=0===c&&0===d?Number.POSITIVE_INFINITY:0===c||0===d?Math.max(c,d):Math.min(c,d);var l={};Object.defineProperty(l,"maxMessageSize",{get:function(){return o}}),this._sctp=l}return r.apply(this,arguments)}}},shimSendThrowTypeError:function(e){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=this,r=t.apply(e,arguments),n=r.send;return r.send=function(){var t=arguments[0];if((t.length||t.size||t.byteLength)>e.sctp.maxMessageSize)throw new DOMException("Message too large (can send a maximum of "+e.sctp.maxMessageSize+" bytes)","TypeError");return n.apply(this,arguments)},r}}},S=function(e,t){var r=e&&e.window,n={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var i in t)hasOwnProperty.call(t,i)&&(n[i]=t[i]);var o=a.log,s=a.detectBrowser(r),u=c||null,d=v||null,l=y||null,p=_||null,f=C||null,m={browserDetails:s,commonShim:f,extractVersion:a.extractVersion,disableLog:a.disableLog,disableWarnings:a.disableWarnings};switch(s.browser){case"chrome":if(!u||!u.shimPeerConnection||!n.shimChrome)return o("Chrome shim is not included in this adapter release."),m;o("adapter.js shimming chrome."),m.browserShim=u,f.shimCreateObjectURL(r),u.shimGetUserMedia(r),u.shimMediaStream(r),u.shimSourceObject(r),u.shimPeerConnection(r),u.shimOnTrack(r),u.shimAddTrackRemoveTrack(r),u.shimGetSendersWithDtmf(r),f.shimRTCIceCandidate(r),f.shimMaxMessageSize(r),f.shimSendThrowTypeError(r);break;case"firefox":if(!l||!l.shimPeerConnection||!n.shimFirefox)return o("Firefox shim is not included in this adapter release."),m;o("adapter.js shimming firefox."),m.browserShim=l,f.shimCreateObjectURL(r),l.shimGetUserMedia(r),l.shimSourceObject(r),l.shimPeerConnection(r),l.shimOnTrack(r),l.shimRemoveStream(r),f.shimRTCIceCandidate(r),f.shimMaxMessageSize(r),f.shimSendThrowTypeError(r);break;case"edge":if(!d||!d.shimPeerConnection||!n.shimEdge)return o("MS edge shim is not included in this adapter release."),m;o("adapter.js shimming edge."),m.browserShim=d,f.shimCreateObjectURL(r),d.shimGetUserMedia(r),d.shimPeerConnection(r),d.shimReplaceTrack(r),f.shimMaxMessageSize(r),f.shimSendThrowTypeError(r);break;case"safari":if(!p||!n.shimSafari)return o("Safari shim is not included in this adapter release."),m;o("adapter.js shimming safari."),m.browserShim=p,f.shimCreateObjectURL(r),p.shimRTCIceServerUrls(r),p.shimCallbacksAPI(r),p.shimLocalStreamsAPI(r),p.shimRemoteStreamsAPI(r),p.shimTrackEventTransceiver(r),p.shimGetUserMedia(r),p.shimCreateOfferLegacy(r),f.shimRTCIceCandidate(r),f.shimMaxMessageSize(r),f.shimSendThrowTypeError(r);break;default:o("Unsupported browser!")}return m}({window:e.window}),k=T;function T(){}T.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,r){this.callbacks=this.callbacks||{};var n=3===arguments.length,i=n?arguments[1]:void 0,a=n?arguments[2]:arguments[1];return a._groupName=i,(this.callbacks[e]=this.callbacks[e]||[]).push(a),this},t.once=function(e,t,r){var n=this,i=3===arguments.length,a=i?arguments[1]:void 0,o=i?arguments[2]:arguments[1];return this.on(e,a,function t(){n.off(e,t),o.apply(this,arguments)}),this},t.releaseGroup=function(e){var t,r,n,i;this.callbacks=this.callbacks||{};for(t in this.callbacks)for(r=0,n=(i=this.callbacks[t]).length;r<n;r++)i[r]._groupName===e&&(i.splice(r,1),r--,n--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var r,n=this.callbacks[e];return n?1===arguments.length?(delete this.callbacks[e],this):(r=n.indexOf(t),n.splice(r,1),0===n.length&&delete this.callbacks[e],this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,r,n,i=[].slice.call(arguments,1),a=this.callbacks[e],o=this.getWildcardCallbacks(e);if(a)for(t=0,r=(n=a.slice()).length;t<r&&n[t];++t)n[t].apply(this,i);if(o)for(r=o.length,t=0,r=(n=o.slice()).length;t<r&&n[t];++t)n[t].apply(this,[e].concat(i));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,r,n=[];for(t in this.callbacks)r=t.split("*"),("*"===t||2===r.length&&e.slice(0,r[0].length)===r[0])&&(n=n.concat(this.callbacks[t]));return n}},T.mixin(T);var b="wss://webrtctest.youme.im",R={rtcpMuxPolicy:"require",bundlePolicy:"max-bundle",iceTransportPolicy:"all"},P=!0,w=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},E=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),M=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},O=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},x=function(e){function t(){var e,r,n;w(this,t);for(var i=arguments.length,a=Array(i),o=0;o<i;o++)a[o]=arguments[o];return r=n=O(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),n._data={video:P,appKey:"",userId:"",token:"",localMediaConstraints:{video:{width:{ideal:320},frameRate:{ideal:12},facingMode:"user"},audio:{autoGainControl:!0,channelCount:1,echoCancellation:!0,noiseSuppression:!0,sampleRate:{ideal:8e3},sampleSize:{ideal:8},volume:.9}}},O(n,r)}return M(t,k),E(t,[{key:"set",value:function(e,t){this._data[e]=t,this.emit("change:"+e,e,t)}},{key:"get",value:function(e){return this._data[e]}}],[{key:"getInstance",value:function(){return t._instance||(t._instance=new t),t._instance}}]),t}().getInstance(),I="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},L=I.WebSocket||I.MozWebSocket,j="disconnected",D="connected",A="reconnecting",U="ended",N=function(e){function t(){var e,r,n;w(this,t);for(var i=arguments.length,a=Array(i),o=0;o<i;o++)a[o]=arguments[o];return r=n=O(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),n._VERSION=1,n._url=b,n._status=j,n._msgQueue=[],n._promiseHash={},n._rejectHash={},n._isCheckingNetwork=!1,n._onNetworkCheckSuccess=[],n._onNetworkCheckFailed=[],n._seq=0,O(n,r)}return M(t,k),E(t,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b;return this._url=e,this._connect(),this._changeStatus("connecting"),this}},{key:"send",value:function(e){var t=this;return this._seq++,e.seq=this._seq,e.version=this._VERSION,this._msgQueue.push(e),this._drainMsgQueue(),this._heartbeatInterval&&clearTimeout(this._heartbeatInterval),this._heartbeatInterval=setTimeout(function(){return t._heartbeat()},6e4),new Promise(function(e,r){t._promiseHash[t._seq+""]=e,t._rejectHash[t._seq+""]=r})}},{key:"getStatus",value:function(){return this._status}},{key:"close",value:function(){this._changeStatus(U),this._socket&&(this._socket.close(),this._socket=null),this._msgQueue=[],this._promiseHash={},this._seq=0,this._heartbeatInterval&&(clearTimeout(this._heartbeatInterval),this._heartbeatInterval=0)}},{key:"checkNetwork",value:function(){var e=this;return new Promise(function(t,r){e._onNetworkCheckSuccess.push(t),e._onNetworkCheckFailed.push(r),e._isCheckingNetwork||e._heartbeat()})}},{key:"_connect",value:function(){this._socket&&this._socket.close(),this._socket=new L(this._url),this._handleSocketEvent()}},{key:"_reconnect",value:function(){var e=this;if(this._status!==U){if(this._status!==A){for(var t in this._rejectHash)this._rejectHash.hasOwnProperty(t)&&this._rejectHash[t](new DOMException("Socket was closed.","NetworkError"));this._promiseHash={},this._rejectHash={},this._changeStatus(A)}this._socket=null,setTimeout(function(){e._status===A&&e._connect()},1e3)}this._heartbeatInterval&&(clearTimeout(this._heartbeatInterval),this._heartbeatInterval=0)}},{key:"_handleSocketEvent",value:function(){var e=this;this._socket.addEventListener("open",function(){e._changeStatus(D),e.emit("ready"),e._drainMsgQueue()}),this._socket.addEventListener("error",function(t){e.emit("error",t)}),this._socket.addEventListener("close",function(){e._reconnect()}),this._socket.addEventListener("message",function(t){var r=JSON.parse(t.data),n=r.seq;n&&e._promiseHash[n]&&(e._promiseHash[n](r),delete e._promiseHash[n],delete e._rejectHash[n]),e.emit("message:"+r.msgtype,r)})}},{key:"_changeStatus",value:function(e){this._status!==e&&(this._status=e,this.emit("status:"+e,e))}},{key:"_drainMsgQueue",value:function(){if(this._status===D){var e=!0,t=!1,r=void 0;try{for(var n,i=this._msgQueue[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var a=n.value;this._socket.send(JSON.stringify(a)),this.emit("send:"+a.msgtype,a)}}catch(e){t=!0,r=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}this._msgQueue=[]}}},{key:"_heartbeat",value:function(){var e=this;if(!this._isCheckingNetwork){this._isCheckingNetwork=!0;var t=setTimeout(function(){e._drainNetworkCheck(!1),e._socket.close(),e._reconnect()},1e4),r=x.get("userId");this.send(r?{msgtype:2,userid:r}:{msgtype:2}).then(function(){clearTimeout(t),e._drainNetworkCheck(!0)}).catch(function(){clearTimeout(t),e._drainNetworkCheck(!1)})}}},{key:"_drainNetworkCheck",value:function(e){if(e){var t=!0,r=!1,n=void 0;try{for(var i,a=this._onNetworkCheckSuccess[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;o&&o()}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}}else{var s=!0,c=!1,u=void 0;try{for(var d,l=this._onNetworkCheckFailed[Symbol.iterator]();!(s=(d=l.next()).done);s=!0){var p=d.value;p&&p()}}catch(e){c=!0,u=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw u}}}this._onNetworkCheckSuccess=[],this._onNetworkCheckFailed=[],this._isCheckingNetwork=!1}}],[{key:"getInstance",value:function(){return t._instance||(t._instance=new t),t._instance}}]),t}().getInstance(),G="stop",F="starting",V=function(e){function t(){var e,r,n;w(this,t);for(var i=arguments.length,a=Array(i),o=0;o<i;o++)a[o]=arguments[o];return r=n=O(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),n._stream=null,n._status=G,n._isPauseVideo=!1,n._isPauseAudio=!1,n._resolveQueue=[],n._rejectQueue=[],O(n,r)}return M(t,k),E(t,[{key:"applyConstraints",value:function(e){var t=this,r=x.get("localMediaConstraints"),n=r.video,i=r.audio;"boolean"==typeof e.video?n=!!e.video:"object"==typeof e.video&&(n=Object.assign(n,e.video)),"boolean"==typeof e.audio?i=!!e.video:"object"==typeof e.audio&&(i=Object.assign(i,e.audio)),r={video:n,audio:i},x.set("localMediaConstraints",r),this._stream&&window.MediaStreamTrack&&MediaStreamTrack.prototype.applyConstraints&&MediaStreamTrack.prototype.getConstraints&&MediaStreamTrack.prototype.getSettings&&(this._stream.getVideoTracks().forEach(function(e){e.applyConstraints(r.video).then(function(){t.emit("applied-constraints-video",e.getConstraints(),e.getSettings())}).catch(function(e){t.emit("error",e)})}),this._stream.getAudioTracks().forEach(function(e){e.applyConstraints(r.audio).then(function(){t.emit("applied-constraints-audio",e.getConstraints(),e.getSettings())}).catch(function(e){t.emit("error",e)})}))}},{key:"start",value:function(){return this._stream?Promise.resolve(this._stream):this._status===F?this.requestStream():(this._changeStatus(F),this._doGetUserMedia())}},{key:"stop",value:function(){this._stream&&(this._stream.getTracks().forEach(function(e){e.stop()}),this._stream=null,this.emit("remove-stream"),this._changeStatus(G))}},{key:"pause",value:function(){this._stream&&this._enableStream(!1),this._isPauseVideo=!0,this._isPauseAudio=!0,this.emit("pause-video"),this.emit("pause-audio")}},{key:"pauseVideo",value:function(){this._stream&&this._enableVideoStream(!1),this._isPauseVideo=!0,this.emit("pause-video")}},{key:"pauseAudio",value:function(){this._stream&&this._enableAudioStream(!1),this._isPauseAudio=!0,this.emit("pause-audio")}},{key:"resume",value:function(){this._stream&&this._enableStream(!0),this._isPauseVideo=!1,this._isPauseAudio=!1,this.emit("resume-video"),this.emit("resume-audio")}},{key:"resumeVideo",value:function(){this._stream&&this._enableVideoStream(!0),this._isPauseVideo=!1,this.emit("resume-video")}},{key:"resumeAudio",value:function(){this._stream&&this._enableAudioStream(!0),this._isPauseAudio=!1,this.emit("resume-audio")}},{key:"isVideoPaused",value:function(){return this._isPauseVideo}},{key:"isAudioPaused",value:function(){return this._isPauseAudio}},{key:"getStatus",value:function(){return this._status}},{key:"requestStream",value:function(){var e=this;return this._stream?Promise.resolve(this._stream):new Promise(function(t,r){e._resolveQueue.push(t),e._rejectQueue.push(r)})}},{key:"_doGetUserMedia",value:function(){var e=this,t=x.get("video"),r=x.get("localMediaConstraints");return navigator.mediaDevices.getUserMedia({audio:r.audio,video:!!t&&r.video}).then(function(t){e._stream=t,e._changeStatus("recording"),e._isPauseVideo&&e._enableVideoStream(!1),e._isPauseAudio&&e._enableAudioStream(!1),e.emit("has-stream",t),window.MediaStreamTrack&&MediaStreamTrack.prototype.applyConstraints&&MediaStreamTrack.prototype.getConstraints&&MediaStreamTrack.prototype.getSettings&&(t.getVideoTracks().forEach(function(t){e.emit("applied-constraints-video",t.getConstraints(),t.getSettings())}),t.getAudioTracks().forEach(function(t){e.emit("applied-constraints-audio",t.getConstraints(),t.getSettings())}));var r=!0,n=!1,i=void 0;try{for(var a,o=e._resolveQueue[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){(0,a.value)(t)}}catch(e){n=!0,i=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}return e._resolveQueue=[],e._rejectQueue=[],t}).catch(function(t){if(t&&t.message&&"Invalid constraint"===t.message){var n=t.constraint;if(r.video&&r.video[n]){var i=r.video[n],a=void 0;if("number"==typeof i)a=i;else{if("object"!=typeof i||!i.ideal&&!i.exact)return e.applyConstraints({video:!0}),e._doGetUserMedia();a=i.ideal||i.exact}var o=2*a,s={video:{}};return s.video[n]={min:a,max:o},e.applyConstraints(s),e._doGetUserMedia()}}e._changeStatus("failed"),e.emit("error",t);var c=!0,u=!1,d=void 0;try{for(var l,p=e._rejectQueue[Symbol.iterator]();!(c=(l=p.next()).done);c=!0){(0,l.value)(t)}}catch(t){u=!0,d=t}finally{try{!c&&p.return&&p.return()}finally{if(u)throw d}}throw e._resolveQueue=[],e._rejectQueue=[],t})}},{key:"_changeStatus",value:function(e){this._status=e,this.emit("status:"+e,e)}},{key:"_enableStream",value:function(e){this._stream.getTracks().forEach(function(t){t.enabled=!!e})}},{key:"_enableVideoStream",value:function(e){this._stream.getVideoTracks().forEach(function(t){t.enabled=!!e})}},{key:"_enableAudioStream",value:function(e){this._stream.getAudioTracks().forEach(function(t){t.enabled=!!e})}}],[{key:"getInstance",value:function(){return t._instance||(t._instance=new t),t._instance}}]),t}().getInstance(),z="new",J="negotiating",H="negotiated",q="failed",B=function(e){function t(e,r,n,i){w(this,t);var a=O(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a._signalingStatus=z,a._stream=null,a._streamResolveQueue=[],a._streamRejectQueue=[],a._localStreamAdded=!1,a._audioMuted=!1,a._isCaller=!1,a._userId=e,a.updateTurnServer(r,n,i),a._handleReconnect(),a}return M(t,k),E(t,[{key:"updateTurnServer",value:function(e,t,r){this._turnAddress=e,this._turnSession=t,this._turnKey=r}},{key:"call",value:function(){var e=this;this._isCaller=!0,this._createPeerConnection(),this._changeSignalingStatus(J),this.ifLocalStreamAdded().then(function(){return e._pc.createOffer(e._offerAnswerOptions)}).then(function(t){return e._pc.setLocalDescription(t)}).then(function(){e.emit("offer",e._pc.localDescription)}).catch(function(t){e.emit("error:offer",t),e._changeSignalingStatus(q)})}},{key:"waitForCalling",value:function(){this._isCaller=!1,this._createPeerConnection(),this._changeSignalingStatus("waiting")}},{key:"onOffer",value:function(e){var t=this;this._changeSignalingStatus(J),this._pc.setRemoteDescription(new RTCSessionDescription(e)).then(function(){return t.ifLocalStreamAdded()}).then(function(){return t._pc.createAnswer(t._offerAnswerOptions)}).then(function(e){return t._pc.setLocalDescription(e)}).then(function(){t.emit("answer",t._pc.localDescription),t._changeSignalingStatus(H)}).catch(function(e){t.emit("error:answer",e),t._changeSignalingStatus(q)})}},{key:"onAnswer",value:function(e){var t=this;this._pc.setRemoteDescription(new RTCSessionDescription(e)).then(function(){t.emit("got-answer"),t._changeSignalingStatus(H)}).catch(function(e){t.emit("error:got-answer",e),t._changeSignalingStatus(q)})}},{key:"onCandidate",value:function(e){var t=this;this._pc.addIceCandidate(new RTCIceCandidate(e)).then(function(){t.emit("got-candidate")}).catch(function(e){t.emit("error:got-candidate",e)})}},{key:"getId",value:function(){return this._userId}},{key:"getSignalingStatus",value:function(){return this._signalingStatus}},{key:"getIceConnectionState",value:function(){return this._pc.iceConnectionState}},{key:"close",value:function(){this._pc.close(),this._changeSignalingStatus(j),this._pc=null,this._stream=null,this._streamResolveQueue=[],this._streamRejectQueue=[]}},{key:"requestStream",value:function(){var e=this;return this._stream?Promise.resolve(this._stream):new Promise(function(t,r){e._streamResolveQueue.push(t),e._streamRejectQueue.push(r)})}},{key:"ifLocalStreamAdded",value:function(){var e=this;return this._localStreamAdded?Promise.resolve():new Promise(function(t){e.once("local-stream-added",function(){return t()})})}},{key:"getMute",value:function(){return this._audioMuted}},{key:"setMute",value:function(e){this._audioMuted=e,this._stream&&this._setAudioMuted(e)}},{key:"_createPeerConnection",value:function(){var e=this;this._offerAnswerOptions={offerToReceiveAudio:1,offerToReceiveVideo:x.get("video")?1:0},this._pc&&(this._pc.close(),this._stream=null),/^turn:/.test(this._turnAddress)||(this._turnAddress="turn:"+this._turnAddress),this._pc=new RTCPeerConnection(Object.assign({iceServers:[{urls:this._turnAddress,username:this._turnSession,credential:this._turnKey}]},R)),this._pc.oniceconnectionstatechange=function(){e._pc?e.emit("ice-status:"+e._pc.iceConnectionState,e._pc.iceConnectionState):e.emit("ice-status:closed","closed")},this._pc.onicecandidate=function(t){t.candidate?e.emit("candidate",t.candidate):e.emit("candidate-finished")},this._pc.ontrack=function(t){var r=!e._stream||e._stream!==t.streams[0];e._stream=t.streams[0];var n=!0,i=!1,a=void 0;try{for(var o,s=e._streamResolveQueue[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){(0,o.value)(e._stream)}}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}e._streamResolveQueue=[],e._streamRejectQueue=[],e._audioMuted&&e._setAudioMuted(!0),r&&e.emit("update-stream",e._stream),e.emit("update-stream",e._stream)},this._pc.onremovestream=function(t){t.stream===e._stream&&e.emit("remove-stream")},this._addLocalStream()}},{key:"_changeSignalingStatus",value:function(e){e!==this._signalingStatus&&(this._signalingStatus=e,this.emit("signaling-status:"+e,e))}},{key:"_addLocalStream",value:function(){var e=this;V.requestStream().then(function(t){t.getTracks().forEach(function(r){return e._pc.addTrack(r,t)}),e._localStreamAdded=!0,e.emit("local-stream-added",t)})}},{key:"_setAudioMuted",value:function(e){this._stream.getAudioTracks().forEach(function(t){t.enabled=!e})}},{key:"_handleReconnect",value:function(){this.on("ice-status:disconnected",function(){N.checkNetwork()})}}]),t}(),Q=5,K=function(e){function t(){w(this,t);var e=O(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._user={},e._userRefCount={},N.on("message:"+Q,function(t){var r=t.content,n=t.sender,i=r.type,a=r.payload,o=e.getUser(n);if(o)switch(i){case"offer":o.onOffer(a);break;case"answer":o.onAnswer(a);break;case"candidate":o.onCandidate(a)}}),e}return M(t,k),E(t,[{key:"getUser",value:function(e){return this._user[e]}},{key:"createUser",value:function(e,t,r,n){if(this._userRefCount[e])return this._userRefCount[e]++,this.getUser(e);var i=this.getUser(e);return i?i.updateTurnServer(t,r,n):(i=new B(e,t,r,n),this._handleUserEvent(i)),this._user[e]=i,this._userRefCount[e]=1,i}},{key:"removeUser",value:function(e){this._userRefCount[e]--,this._userRefCount[e]||this.getUser(e).close()}},{key:"callUser",value:function(e){this.getUser(e).call()}},{key:"waitUserForCall",value:function(e){this.getUser(e).waitForCalling()}},{key:"updateUserTurnServer",value:function(e,t,r,n){var i=this._user[e];i&&i.updateTurnServer(t,r.turnKey)}},{key:"clear",value:function(){var e=Object.keys(this._user),t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.removeUser(o)}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}this._user={},this._userRefCount={}}},{key:"requestUserStream",value:function(e){return this.getUser(e).requestStream()}},{key:"getMute",value:function(e){var t=this.getUser(e);return t?t.getMute():void 0}},{key:"setMute",value:function(e,t){var r=this.getUser(e);return r?r.setMute(t):void 0}},{key:"setAllMute",value:function(e){var t=Object.keys(this._user),r=!0,n=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;this.setMute(s,e)}}catch(e){n=!0,i=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}}},{key:"_handleUserEvent",value:function(e){var r=this,n=e.getId();e.on("offer",function(e){t._sendMessage(n,e,"offer"),r.emit("offer:"+n,n,e)}),e.on("answer",function(e){t._sendMessage(n,e,"answer"),r.emit("answer:"+n,n,e)}),e.on("candidate",function(e){t._sendMessage(n,e,"candidate"),r.emit("candidate:"+n,n,e)}),e.on("got-answer",function(){return r.emit("got-answer:"+n,n)}),e.on("got-candidate",function(){return r.emit("got-candidate:"+n,n)}),e.on("candidate-finished",function(){return r.emit("candidate-finished:"+n,n)}),e.on("ice-status:*",function(e,t){return r.emit("ice-status:"+n+":"+t,n,t)}),e.on("signaling-status:*",function(e,t){return r.emit("signaling-status:"+n+":"+t,n,t)}),e.on("update-stream",function(e){return r.emit("update-stream:"+n,n,e)}),e.on("remove-stream",function(){return r.emit("remove-stream:"+n,n)}),e.on("local-stream-added",function(e){return r.emit("local-stream-added:"+n,n,e)}),e.on("error:*",function(e,t){return r.emit(e+":"+n,n,t)})}}],[{key:"_sendMessage",value:function(e,t,r){N.send({msgtype:4,receiver:e,content:{type:r,payload:t}})}},{key:"getInstance",value:function(){return t._instance||(t._instance=new t),t._instance}}]),t}().getInstance(),W="out",Y=function(e){function t(e){w(this,t);var r=O(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._status=W,r._members={},r._roomId=e,r}return M(t,k),E(t,[{key:"getId",value:function(){return this._roomId}},{key:"setJoining",value:function(){this._changeStatus("joining")}},{key:"joinIn",value:function(e,t,r,n){this._roomKey=e,this.updateTurnServer(t,r,n),this._changeStatus("in")}},{key:"updateTurnServer",value:function(e,t,r){this._turnAddress=e,this._turnSession=t,this._turnKey=r;var n=!0,i=!1,a=void 0;try{for(var o,s=this.getMemberIdList()[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var c=o.value;this._members[c].updateTurnServer(e,t,r)}}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}}},{key:"getMembers",value:function(){return this._members}},{key:"getMemberIdList",value:function(){return Object.keys(this._members)}},{key:"updateMembers",value:function(e,t,r){var n=this;return this.doIfJoined().then(function(){var i=x.get("userId"),a=!0,o=!1,s=void 0;try{for(var c,u=e[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var d=c.value;n._members[d]||d===i||(n._members[d]=K.createUser(d,n._turnAddress,n._turnSession,n._turnKey),r||t===i?K.callUser(d):K.waitUserForCall(d))}}catch(e){o=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw s}}return n._members[t]||t===i||(n._members[t]=K.createUser(t,n._turnAddress,n._turnSession,n._turnKey),r?K.callUser(t):K.waitUserForCall(t)),n})}},{key:"leaveMember",value:function(e){this._members[e]&&(delete this._members[e],K.removeUser(e))}},{key:"clear",value:function(){var e=Object.keys(this._members),t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.leaveMember(o)}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}}},{key:"leaveRoom",value:function(){this.clear(),this._changeStatus(W)}},{key:"doIfJoined",value:function(){var e=this;return new Promise(function(t,r){"in"===e._status?t():e.once("status:in",function(){return t()})})}},{key:"getStatus",value:function(){return this._status}},{key:"_changeStatus",value:function(e){this._status!==e&&(this._status=e,this.emit("status:"+e,e))}}]),t}(),$=6,X=7,Z=function(e){function t(){w(this,t);var e=O(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._rooms={},N.on("message:"+$,function(r){var n=r.roomid;if(e._rooms[n]){var i=e._rooms[n].getMemberIdList();e._rooms[n].updateMembers(r.members,r.joinmember).then(function(r){var a=r.getMemberIdList(),o=t._compareList(i,a),s=!0,c=!1,u=void 0;try{for(var d,l=o.add[Symbol.iterator]();!(s=(d=l.next()).done);s=!0){var p=d.value;e.emit("member-join:"+n,n,p)}}catch(e){c=!0,u=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw u}}var f=!0,m=!1,h=void 0;try{for(var v,g=o.minus[Symbol.iterator]();!(f=(v=g.next()).done);f=!0){var y=v.value;e.emit("member-leave:"+n,n,y)}}catch(e){m=!0,h=e}finally{try{!f&&g.return&&g.return()}finally{if(m)throw h}}e.emit("update:"+r.getId(),r.getId(),r.getMemberIdList())})}}),N.on("message:"+X,function(t){var r=t.roomid;e._rooms[r]&&(e._rooms[r].leaveMember(t.leavemember),e.emit("member-leave:"+r,r,t.leavemember),e.emit("update:"+r,r,e._rooms[r].getMemberIdList()))}),e}return M(t,k),E(t,[{key:"joinRoom",value:function(e){var t=this;this._rooms[e]||(this._rooms[e]=new Y(e));var r=this._rooms[e];return r.getStatus()!==W?Promise.resolve(r):(r.setJoining(),N.send({msgtype:3,roomid:e}).then(function(n){return r.joinIn(n.roomkey,n.turnaddr,n.session,n.sessionkey),t.emit("join:"+e,e),r}))}},{key:"leaveRoom",value:function(e){var t=this,r=this._rooms[e];N.send({msgtype:8,roomid:e}).then(function(){r.leaveRoom(),delete t._rooms[e],t.emit("leave:"+e,e)})}},{key:"leaveAllRoom",value:function(){var e=Object.keys(this._rooms),t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.leaveRoom(o)}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}}},{key:"clear",value:function(){var e=Object.keys(this._rooms),t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this._rooms[o].leaveRoom()}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}this._rooms={}}},{key:"inRoom",value:function(e){return!!this._rooms[e]}},{key:"getRoomIdList",value:function(){return Object.keys(this._rooms)}},{key:"getRoom",value:function(e){return this._rooms[e]}},{key:"getRoomMembers",value:function(e){var t=this._rooms[e];return t?t.getMembers():null}},{key:"getRoomMemberIdList",value:function(e){var t=this._rooms[e];return t?t.getMemberIdList():null}},{key:"reconnect",value:function(){var e=this,t=function(t){var r=e._rooms[t];r.setJoining(),N.send({msgtype:8,roomid:t}).then(function(){return r.leaveRoom(),N.send({msgtype:3,roomid:t})}).then(function(e){r.joinIn(e.roomkey,e.turnaddr,e.session,e.sessionkey)})},r=!0,n=!1,i=void 0;try{for(var a,o=this.getRoomIdList()[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){t(a.value)}}catch(e){n=!0,i=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}}}],[{key:"_compareList",value:function(e,t){e.sort(),t.sort();for(var r=0,n=0,i=[],a=[];r<e.length||n<t.length;){for(;r<e.length&&(n>=t.length||e[r]<t[n]);)i.push(e[r]),r++;for(;n<t.length&&(r>=e.length||e[r]>t[n]);)a.push(t[n]),n++;for(;r<e.length&&n<t.length&&e[r]===t[n];)r++,n++}return{add:a,minus:i}}},{key:"getInstance",value:function(){return t._instance||(t._instance=new t),t._instance}}]),t}().getInstance(),ee=function(e){function t(){var e,r,n;w(this,t);for(var i=arguments.length,a=Array(i),o=0;o<i;o++)a[o]=arguments[o];return r=n=O(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),n._isLogin=!1,n._logging=!1,n._appKey="",n._userId="",n._token="",O(n,r)}return M(t,k),E(t,[{key:"login",value:function(e,t,r){var n=this;if(this._isLogin){if(t===this._userId)return Promise.resolve(!0);this.logout()}return x.set("appKey",e),x.set("userId",t),x.set("token",r),this._appKey=e,this._userId=t,this._token=r,N.getStatus()!==j&&N.getStatus()!==U||N.init(),this._logging=!0,this.emit("logging"),N.send({msgtype:1,appkey:e,userid:t,token:r}).then(function(e){return n._isLogin=!0,n._logging=!1,n.emit("login"),!0})}},{key:"logout",value:function(){Z.clear(),K.clear(),N.close(),this._isLogin=!1,this._userId="",this.emit("logout")}},{key:"isLogin",value:function(){return this._isLogin}},{key:"doIfLogged",value:function(){var e=this;return new Promise(function(t,r){e._isLogin?t():e.once("login",function(){return t()})})}},{key:"getMyUserId",value:function(){return this._userId}},{key:"reconnect",value:function(){return this._isLogin=!1,this._logging=!1,this.login(this._appKey,this._userId,this._token)}}],[{key:"getInstance",value:function(){return t._instance||(t._instance=new t),t._instance}}]),t}().getInstance(),te=function(e){function t(e){w(this,t);var r=O(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._appKey="",r._handleAccountEvent(),r._handleRoomEvent(),r._handleUserEvent(),r._handleLocalMediaEvent(),r._handleSignalingEvent(),r._handleReconnect(),e&&r.init(e),r}return M(t,k),E(t,[{key:"init",value:function(e){e.appKey&&(this._appKey=e.appKey,e.userId&&e.token&&this.login(e.userId,e.token),e.roomId&&this.joinRoom(e.roomId)),void 0!==e.video&&x.set("video",!!e.video),e.localMediaConstraints&&V.applyConstraints(e.localMediaConstraints)}},{key:"login",value:function(e,t){return ee.login(this._appKey,e,t)}},{key:"logout",value:function(){return ee.logout()}},{key:"getMyUserId",value:function(){return ee.getMyUserId()}},{key:"joinRoom",value:function(e){return Promise.all([ee.doIfLogged(),V.requestStream()]).then(function(){Z.joinRoom(e)})}},{key:"leaveRoom",value:function(e){return e?Z.leaveRoom(e):Z.leaveAllRoom()}},{key:"inRoom",value:function(e){return Z.inRoom(e)}},{key:"getRoomIdList",value:function(){return Z.getRoomIdList()}},{key:"getRoomMemberIdList",value:function(e){return Z.getRoomMemberIdList(e)}},{key:"requestUserStream",value:function(e){return K.requestUserStream(e)}},{key:"getMute",value:function(e){return K.getMute(e)}},{key:"setMute",value:function(e,t){return K.setMute(e,t)}},{key:"setAllMute",value:function(e){return K.setAllMute(e)}},{key:"startRTC",value:function(){return this.startLocalMedia()}},{key:"startLocalMedia",value:function(){return V.start()}},{key:"pauseLocalMedia",value:function(){return V.pause()}},{key:"pauseLocalVideo",value:function(){return V.pauseVideo()}},{key:"pauseLocalAudio",value:function(){return V.pauseAudio()}},{key:"pause",value:function(){return this.pauseLocalMedia()}},{key:"resumeLocalMedia",value:function(){return V.resume()}},{key:"resumeLocalVideo",value:function(){return V.resumeVideo()}},{key:"resumeLocalAudio",value:function(){return V.resumeAudio()}},{key:"resume",value:function(){return this.resumeLocalMedia()}},{key:"isLocalVideoPaused",value:function(){return V.isVideoPaused()}},{key:"isLocalAudioPaused",value:function(){return V.isAudioPaused()}},{key:"stopLocalMedia",value:function(){return V.stop()}},{key:"getLocalMediaStatus",value:function(){return V.getStatus()}},{key:"requestLocalMediaStream",value:function(){return V.requestStream()}},{key:"_handleReconnect",value:function(){N.on("status:reconnecting",function(){return ee.reconnect().then(function(){return Z.reconnect()})})}},{key:"_handleAccountEvent",value:function(){var e=this;ee.on("login",function(){return e.emit("account.logged")}),ee.on("logging",function(){return e.emit("account.logging")}),ee.on("logout",function(){return e.emit("account.logout")})}},{key:"_handleRoomEvent",value:function(){var e=this;Z.on("update:*",function(t,r,n){return e.emit("room.update:"+r,r,n)}),Z.on("member-join:*",function(t,r,n){return e.emit("room.member-join:"+r,r,n)}),Z.on("member-leave:*",function(t,r,n){return e.emit("room.member-leave:"+r,r,n)}),Z.on("join:*",function(t,r){return e.emit("room.join:"+r,r)}),Z.on("leave:*",function(t,r){return e.emit("room.leave:"+r,r)})}},{key:"_handleUserEvent",value:function(){var e=this;K.on("offer:*",function(t,r,n){return e.emit("user.offer:"+r,r,n)}),K.on("answer:*",function(t,r,n){return e.emit("user.answer:"+r,r,n)}),K.on("candidate:*",function(t,r,n){return e.emit("user.candidate:"+r,r,n)}),K.on("got-answer:*",function(t,r){return e.emit("user.got-answer:"+r,r)}),K.on("got-candidate:*",function(t,r){return e.emit("user.got-candidate:"+r,r)}),K.on("candidate-finished:*",function(t,r){return e.emit("user.candidate-finished:"+r,r)}),K.on("ice-status:*",function(t,r,n){return e.emit("user.ice-status:"+r+":"+n,r,n)}),K.on("signaling-status:*",function(t,r,n){return e.emit("user.signaling-status:"+r+":"+n,r,n)}),K.on("update-stream:*",function(t,r,n){return e.emit("user.update-stream:"+r,r,n)}),K.on("remove-stream:*",function(t,r){return e.emit("user.remove-stream:"+r,r)}),K.on("local-stream-added:*",function(t,r,n){return e.emit("user.local-stream-added:"+r,r,n)}),K.on("error:*",function(t,r,n){return e.emit("user."+t,r,n)})}},{key:"_handleLocalMediaEvent",value:function(){var e=this;V.on("status:*",function(t,r){return e.emit("local-media.status:"+r,r)}),V.on("has-stream",function(t){return e.emit("local-media.has-stream",t)}),V.on("remove-stream",function(){return e.emit("local-media.remove-stream")}),V.on("pause-video",function(){return e.emit("local-media.pause-video")}),V.on("pause-audio",function(){return e.emit("local-media.pause-audio")}),V.on("resume-video",function(){return e.emit("local-media.resume-video")}),V.on("resume-audio",function(){return e.emit("local-media.resume-audio")}),V.on("error",function(t){return e.emit("local-media.error",t)}),V.on("applied-constraints-video",function(t,r){return e.emit("local-media.applied-constraints-video",t,r)}),V.on("applied-constraints-audio",function(t,r){return e.emit("local-media.applied-constraints-audio",t,r)})}},{key:"_handleSignalingEvent",value:function(){var e=this;N.on("status:*",function(t,r){return e.emit("signaling.status:"+r,r)}),N.on("ready",function(){return e.emit("signaling.ready")}),N.on("message:*",function(t,r){return e.emit("signaling.receive:"+r.msgtype,r)}),N.on("send:*",function(t,r){return e.emit("signaling.send:"+r.msgtype,r)}),N.on("error",function(t){return e.emit("signaling.error",t)})}}]),t}();return te.support=!!S.browserDetails.version,te});
